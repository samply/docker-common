# This workflow represents the continuous integration pipeline for the samply/tomcat-common docker image
name: Build, Test and Deploy samply/tomcat-common

on:
  workflow_dispatch:
  schedule:
    - cron: '0 8 * * *' # everyday at 8am
  push:
    branches:
      - $default-branch
      - develop
    tags:
      - "*.*.*"
  pull_request:
    branches:
      - $default-branch
      - develop

jobs:
  ci:
    strategy:
      matrix:
        include:
          - tomcat_version: "10"
            image_suffix: "-tomcat-10"
    # This workflow defines how a samply docker image is built, tested and published.
    # Visit: https://github.com/samply/github-workflows/blob/main/.github/workflows/docker-ci.yml, for more information
    uses: samply/github-workflows/.github/workflows/docker-ci.yml@main
    with:
      # The Docker Hub Repository you want eventually push to, e.g samply/share-client
      image-name: "samply/tomcat-common"
      # Define special prefixes for docker tags. They will prefix each images tag.
      image-tag-prefix: "${{matrix.tomcat_version}}-"
      # Where to push your images ("dockerhub", "ghcr", "both" or "none")
      push-to: dockerhub
      # Define the Dockerfile of your image, typically default './Dockerfile' will be enough
      build-file: "./tomcat/Dockerfile"
      # A list of build arguments, passed to the docker build
      build-args: |
        TOMCAT_VERSION=${{matrix.tomcat_version}}
      # Define the target platforms of the docker build (default "linux/amd64,linux/arm64/v8")
      #build-platforms: "linux/amd64,linux/arm64/v8"
    # This passes the secrets from calling workflow to the called workflow
    secrets:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}
